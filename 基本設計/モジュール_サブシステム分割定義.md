# モジュール/サブシステム分割定義

## 1. 概要
本設計書は、アーティストイベント管理SaaSサービス「Fanlogue」を構成する主要なモジュールおよびサブシステムを定義し、それぞれの役割と責任範囲を明確にすることを目的とする。  
これにより、システム全体の構造を理解し、各コンポーネントの独立性と連携性を確保した効率的な開発を促進する。

---

## 2. 全体アーキテクチャの再確認
「論理構成図設計書」で定義されたアーキテクチャに基づき、Fanlogueシステムは複数の独立したサービス（モジュール/サブシステム）で構成される。  
これらのサービスはAPI Gatewayを介して連携し、それぞれが特定のビジネスロジックとデータストアを担当する。

---

## 3. モジュール/サブシステム定義
Fanlogueシステムは、以下の主要なモジュール/サブシステムに分割される。

### 3.1. 認証・認可モジュール (Authentication & Authorization Module)
- **役割:**  
  ユーザーの認証（ログイン、登録、パスワードリセット）と、APIへのアクセス認可を管理する統合レイヤー。  
  AWS Cognitoをインフラとして利用し、その機能をアプリケーションの要件に合わせて抽象化・連携する。

- **責任範囲:**  
  - Cognitoを通じたユーザーの登録、ログイン、セッション管理のインターフェース提供。  
  - Cognitoから発行された認証トークン（アクセストークン、リフレッシュトークン）の検証と管理。  
  - パスワードリセットフローの管理（Cognitoとの連携を含む）。  
  - ソーシャルログイン連携の処理（Cognito Federationまたはカスタム連携）。  
  - アプリケーションレベルでのユーザーのロールや権限の解釈と、APIへのアクセス認可の判断。  
  - 認証後のアプリケーション固有の初期処理（例：新規ユーザーのデフォルト設定登録など）。

- **連携する主なモジュール:**  
  ユーザー管理モジュール（ユーザー情報登録時）、API Gateway（認証リクエストの受付）

- **関連データストア:**  
  `users` テーブル（ユーザーID、Cognito連携情報、アプリケーション固有のロールなど）

- **利用する主要なインフラ:**  
  AWS Cognito

---

### 3.2. ユーザー管理モジュール (User Management Module)
- **役割:**  
  ユーザーのプロフィール情報、ポイント残高、および関連する設定を管理する。

- **責任範囲:**  
  - ユーザープロフィールの取得、更新。  
  - ユーザーの現在のポイント残高の管理と提供。  
  - ユーザーのポイント履歴の管理。  
  - ユーザーがフォローしているアーティスト情報の管理。  
  - ユーザーが参加したイベント情報の管理。

- **連携する主なモジュール:**  
  認証・認可モジュール（ユーザー登録/ログイン後の連携）、報酬・ポイントシステムモジュール（ポイント変動時）、アーティスト管理モジュール（フォロー情報取得時）、イベント管理モジュール（参加イベント情報取得時）

- **関連データストア:**  
  `users` テーブル、`artist_follows` テーブル、`event_attendances` テーブル、`point_histories` テーブル

---

### 3.3. アーティスト管理モジュール (Artist Management Module)
- **役割:**  
  アーティスト情報の登録、更新、取得、およびユーザーとアーティストのフォロー関係を管理する。

- **責任範囲:**  
  - アーティスト情報のCRUD（作成、読み取り、更新、削除）。  
  - アーティストのプロフィール画像やSNSリンクの管理。  
  - ユーザーによるアーティストフォロー/アンフォローの処理。  
  - ユーザーがフォローしているアーティストの一覧提供。

- **連携する主なモジュール:**  
  ユーザー管理モジュール（ユーザーのフォロー情報更新時）、イベント管理モジュール（アーティストに紐づくイベント情報提供時）

- **関連データストア:**  
  `artists` テーブル、`artist_follows` テーブル

---

### 3.4. イベント管理モジュール (Event Management Module)
- **役割:**  
  イベント情報の登録、更新、取得、およびユーザーのイベント参加記録を管理する。

- **責任範囲:**  
  - イベント情報のCRUD（作成、読み取り、更新、削除）。  
  - イベントの画像やチケットURL、開催場所などの詳細情報の管理。  
  - イベントのステータス管理（開催予定、開催中、終了、中止など）。  
  - ユーザーのイベント参加記録の登録と検証。  
  - イベントタグの管理とイベントへのタグ付け。

- **連携する主なモジュール:**  
  アーティスト管理モジュール（アーティストに紐づくイベントの作成/取得時）、報酬・ポイントシステムモジュール（イベント参加時の報酬付与トリガー）、外部連携モジュール（チケットプラットフォーム連携時）

- **関連データストア:**  
  `events` テーブル、`event_attendances` テーブル、`event_tags` テーブル、`event_tag_relations` テーブル

---

### 3.5. 報酬・ポイントシステムモジュール (Reward & Point System Module)
- **役割:**  
  イベント参加などによってユーザーに付与される報酬（スタンプ、ポイント）の定義と、その付与・管理を行う。

- **責任範囲:**  
  - 報酬テンプレート（スタンプ、ポイント）の定義と管理。  
  - イベント参加記録に基づいたスタンプの自動付与。  
  - イベント参加記録に基づいたポイントの自動付与。  
  - ポイントの増減履歴の記録。  
  - ユーザーの現在のポイント残高の更新（ユーザー管理モジュールと連携）。

- **連携する主なモジュール:**  
  イベント管理モジュール（イベント参加記録受信時）、ユーザー管理モジュール（ポイント残高更新時）、通知モジュール（報酬付与通知時）

- **関連データストア:**  
  `rewards` テーブル、`stamps` テーブル、`point_histories` テーブル、`users` テーブル（ポイント残高の更新）

---

### 3.6. 通知モジュール (Notification Module)
- **役割:**  
  ユーザーへのプッシュ通知、メール通知、アプリ内通知など、各種通知を管理・送信する。

- **責任範囲:**  
  - イベント開催リマインダーの送信。  
  - 報酬付与完了通知の送信。  
  - フォローアーティストの新規イベント通知。  
  - システムからのお知らせ通知。  
  - 通知チャネル（FCM, APNs, メールサービスなど）との連携。

- **連携する主なモジュール:**  
  イベント管理モジュール、報酬・ポイントシステムモジュール、アーティスト管理モジュール、ユーザー管理モジュール（通知先ユーザー情報取得）

- **関連データストア:**  
  なし（通知内容のログは別途ログシステムで管理）

---

### 3.7. 運営管理モジュール (Admin Management Module)
- **役割:**  
  運営者向けの管理画面を提供し、システム内の各種データ（ユーザー、アーティスト、イベント、報酬など）の管理機能を提供する。

- **責任範囲:**  
  - ユーザー情報の閲覧、編集、削除。  
  - アーティスト情報の登録、更新、削除。  
  - イベント情報の登録、更新、削除、ステータス変更。  
  - 報酬テンプレートの管理。  
  - システム全体の統計情報やログの閲覧（オブザーバビリティ層と連携）。  
  - 運営者アカウントの管理。

- **連携する主なモジュール:**  
  ユーザー管理モジュール、アーティスト管理モジュール、イベント管理モジュール、報酬・ポイントシステムモジュール、認証・認可モジュール

- **関連データストア:**  
  各モジュールが管理するデータストアへのアクセス

---

### 3.8. 外部連携モジュール (External Integration Module)
- **役割:**  
  外部システム（チケットプラットフォーム、SNSなど）とのデータ連携インターフェースを提供する。

- **責任範囲:**  
  - チケットプラットフォームからのコールバック（購入、参加確認など）の受信と解析。  
  - SNSプラットフォームからのWebhookイベントの受信と解析。  
  - 外部システムへのデータ送信（例: イベント情報の連携、SNSへの自動投稿 - フェーズ2以降
