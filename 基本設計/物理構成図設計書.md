#Fanlogue 基本設計書 - 物理構成図設計書（フェーズ1 MVP版）

#### 1. システム全体設計書

##### 1.1. システム構成図

###### 1.1.2. 物理構成図設計書

本設計書では、FanlogueサービスのMVP（Minimum Viable Product）フェーズ1における、費用を極限まで抑えた物理的なシステム構成を定義します。主にAWS（Amazon Web Services）を想定し、サーバーレスサービスやマネージドサービスを積極的に採用することで、運用コストとインフラ費用を最小限に抑えることを目指します。

**目的:**

* システムのデプロイ環境を具体的に特定し、インフラ基盤の構築方針を明確にする。
* 費用最適化を最優先としつつ、スケーラビリティ、パフォーマンス、信頼性、セキュリティといった非機能要件（NFR7.2.x, NFR7.3.x, NFR7.5.x）を満たすためのAWSサービス選定とその配置を示す。
* 開発・運用チームがシステム基盤を共通理解するための視覚的な表現を提供する。

**対象範囲:**

* フロントエンドはS3 + CloudFrontによる静的ホスティング（SPA）。
* バックエンドはAWS Lambda + API Gatewayを主軸としたサーバーレスアーキテクチャ。
* データベース、キャッシュ、オブジェクトストレージ、非同期処理、CI/CD、監視・ログ収集のAWSサービス配置。
* MVPフェーズにおける必要最低限の冗長性・スケーラビリティを考慮した構成。
<br><br>

\`\`\`mermaid
graph TD
  subgraph Internet
    A[ユーザー]
  end

  subgraph AWS
    subgraph Public Subnet Zone A_B
      ApiGw[AWS API Gateway]
      Cognito[AWS Cognito User Pool]
    end

    subgraph Private Subnet Zone A_B
      Lambda[AWS Lambda Backend API]
      Db[AWS Aurora Serverless v2 PostgreSQL]
      Worker[AWS Lambda Worker]
      S3[AWS S3]
      ApiGw --> Lambda
      Lambda --> Db
      Worker --> Db
      Worker --> S3
      Lambda --> S3
    end

    CloudFront[AWS CloudFront CDN]
    Route53[AWS Route 53 DNS]
    Build[AWS CodeBuild]
    Deploy[AWS CodeDeploy Serverless Framework]
    CW[AWS CloudWatch]

    Route53 --> CloudFront
    CloudFront --> S3

    A -->|HTTPS| CloudFront
    A -->|HTTPS| Cognito
    A -->|HTTPS| ApiGw

    Build --> Deploy
    Deploy --> Lambda
    Deploy --> ApiGw
    Deploy --> S3

    Lambda --> CW
    Db --> CW
    Worker --> CW
    S3 --> CW
    ApiGw --> CW
  end

  subgraph GitHub
    Repo[GitHub Repository]
    Repo --> Build
  end
\`\`\`
---

##### 各AWSサービスの説明と費用最適化のポイント

| サービス名 | 役割 | 費用最適化のポイント |
|--|--|--|
| **AWS Route 53 (DNS)**            | ドメイン管理とDNS解決。ユーザーからのリクエストを適切にCloudFrontへルーティング。                | DNSサービスは一般的に低コスト。問い合わせ数に応じた従量課金。                                              |
| **AWS CloudFront / CDN**           | 静的コンテンツ（PWAアセット、画像、CSS、JS）のキャッシュと高速配信。                             | エッジロケーションでのキャッシュによりオリジン（S3）へのアクセス削減。従量課金制で必要な分だけ利用可能。  |
| **AWS S3 (Static Website Hosting)** | フロントエンド（SPA）の静的ファイルホスティング。ユーザーが直接アクセスするWebサイトコンテンツを格納。 | サーバーレス静的ホスティングでEC2不要。ストレージ容量・リクエスト数に応じた低コスト従量課金。              |
| **AWS API Gateway**                | フロントエンドからのAPIリクエストを受け付け、AWS Lambdaへルーティング。認証・レート制限も担当。       | リクエスト数とデータ転送量に応じた従量課金。アイドル状態の費用は不要。                                    |
| **AWS Lambda (Backend API)**       | バックエンドのビジネスロジックを実行するサーバーレスコンピューティングサービス。                   | 実行時間とメモリ量に応じた従量課金。アイドル状態は無料。負荷に応じた自動スケールでコスト効率良好。         |
| **AWS Aurora Serverless v2 (PostgreSQL)** | ユーザーデータなど永続リレーショナルデータを保存。                                                | 容量・CPU使用量に応じ自動スケール。アイドル時はリソースを最小化し費用を抑制。                               |
| **AWS Cognito**                   | ユーザー認証と管理。セキュリティの強化と認証フローの簡素化。                                       | 利用数に応じた従量課金。認証機能をAWSマネージドサービスで実装し、運用コストを削減。                         |
| **AWS S3 (Object Storage)**       | 静的アセットやユーザーアップロードファイルの保存。                                                | 非常に低コストなストレージ。保存容量とリクエスト数に応じた従量課金。                                      |
| **AWS CodeBuild**                 | ソースコードのビルド、テストを実行。                                                             | 利用したビルド時間に応じた従量課金。未使用時はコスト発生なし。                                            |
| **AWS CodeDeploy / Serverless Framework** | Lambda関数、API Gateway、S3へのアプリ自動デプロイを実施。                                          | デプロイツール自体は低コストまたは無料。自動化により運用工数・コスト削減。                                 |
| **AWS CloudWatch**                | システムメトリクスの収集、ログ管理、アラーム設定。                                                | 監視するログ量やメトリクス数を限定し、必要最小限に抑えることでコスト削減が可能。                           |
