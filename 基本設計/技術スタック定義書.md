# 技術スタック定義設計書（フェーズ1 MVP版）

## 2. 技術スタック定義設計書

本設計書では、FanlogueサービスのMVP（Minimum Viable Product）フェーズ1において採用する具体的な技術スタックを定義し、その選定理由を記述します。  
費用最適化、開発効率、スケーラビリティ、運用容易性を総合的に考慮した上で、各コンポーネントの技術を選定します。

---

### 2.1. 全体方針

- **サーバーレス優先**  
  運用コストとスケーラビリティを最大化するため、可能な限りサーバーレスなAWSサービスを採用します。

- **マネージドサービス活用**  
  インフラ管理の負担を軽減し、開発に集中するため、AWSのフルマネージドサービスを積極的に利用します。

- **モダンな技術スタック**  
  開発効率と将来的な拡張性を考慮し、コミュニティが活発で学習リソースが豊富なモダンな技術を選定します。

- **費用最適化**  
  MVPフェーズにおいて、初期費用と運用費用を極限まで抑えることを重視します。

---

### 2.2. 各コンポーネントの技術スタック

#### 2.2.1. フロントエンド

- **技術**: React.js (with Next.js)  
- **選定理由**:  
  - PWA対応が容易で、Next.jsはSSR/SSGやAPIルートなどPWAに必要な機能を備える  
  - コンポーネント指向で開発効率が高く、活発なコミュニティによる豊富なライブラリが利用可能  
  - パフォーマンス面で優れ、SEO対策にも有利  
  - モバイルファーストのレスポンシブデザインに適している  
- **補足**: Vue.jsも候補だったが、Reactの国内コミュニティ規模やNext.jsのPWA対応力を重視

#### 2.2.2. バックエンドAPI (サーバーレス)

- **技術**: Node.js (Express.jsまたはNestJS) + TypeScript on AWS Lambda  
- **選定理由**:  
  - Lambdaとの相性が良く、軽量で高速なAPI構築が可能  
  - TypeScriptによる型安全でコード品質と保守性が向上  
  - フロントエンドと同じ言語（JavaScript/TypeScript）で開発でき、学習コスト・再利用性が向上  
  - npmエコシステムで豊富なライブラリが利用可能  
  - Express.jsは迅速開発向き、NestJSは将来的な大規模化に対応可能  
  - Lambdaの従量課金でコストを最小化  
- **補足**: Python(Django)も候補だが言語統一とLambda効率を優先

#### 2.2.3. データベース

- **技術**: AWS Aurora Serverless v2 (PostgreSQL互換)  
- **選定理由**:  
  - PostgreSQL互換で既存知見やツールの活用が可能  
  - 最低ACU設定でアイドル時の費用を極限まで削減可能  
  - 自動スケールでトラフィック増にも柔軟対応  
  - 高可用性・耐久性がAWSにより保証  
- **補足**: DynamoDBは費用面で検討したがリレーショナル要件と既存互換性を重視しAuroraを選定

#### 2.2.4. セッション管理

- **フェーズ1 MVP**: JWT (JSON Web Tokens) によるステートレス認証  
- **フェーズ2以降**: AWS ElastiCache for Redis導入予定  
- **選定理由**:  
  - JWTはサーバー側にセッション情報を持たず、費用ゼロで運用可能  
  - Lambdaとの相性が良く、水平スケール時のセッション共有問題を回避  
  - フェーズ2で高速なキャッシュ管理やPub/Sub機能が必要になった段階でElastiCacheを導入し費用対効果を保つ

#### 2.2.5. オブジェクトストレージ

- **技術**: AWS S3 (Simple Storage Service)  
- **選定理由**:  
  - 99.999999999%の耐久性を持ち、信頼性が非常に高い  
  - 容量無制限でスケーラビリティ抜群  
  - 低コストな従量課金制で静的コンテンツやアップロードファイルに最適  
  - CloudFront連携による高速配信も可能

#### 2.2.6. 非同期処理（フェーズ2以降）

- **技術**: AWS SQS + AWS Lambda (Worker)  
- **選定理由**:  
  - コンポーネント間の疎結合化を実現し、独立したスケールや開発を可能にする  
  - メッセージの耐久性と再試行機能で堅牢性が高い  
  - 急激な負荷変動にも柔軟対応しAPI応答性能を維持  
  - 従量課金でアイドル時は費用ゼロ

#### 2.2.7. インフラ管理

- **技術**: AWS CloudFormation または AWS CDK (Cloud Development Kit)  
- **選定理由**:  
  - IaCで環境の一貫性と再現性を確保  
  - 環境構築・更新の自動化で運用ミスを削減  
  - AWSネイティブで最新サービスに迅速対応  
  - CDKはTypeScript/Python記述が可能で開発者に優しい

#### 2.2.8. CI/CD (継続的インテグレーション／デリバリー)

- **技術**:  
  - ソースコード管理: GitHub  
  - ビルド: AWS CodeBuild  
  - デプロイ: AWS CodeDeploy / Serverless Framework  
- **選定理由**:  
  - GitHubは無料プラン充実でチーム開発に最適  
  - CodeBuildは使用時間に応じた従量課金で無駄がない  
  - CodeDeploy / Serverless Frameworkでデプロイ自動化と安全なリリースを実現  
  - 自動化で開発サイクル高速化とヒューマンエラー低減

#### 2.2.9. 監視・ロギング

- **技術**: AWS CloudWatch  
- **選定理由**:  
  - AWSサービスのメトリクスやログを一元管理し可視化可能  
  - 異常時のアラート設定が容易  
  - 基本無料枠あり、従量課金もコストを抑えやすい

---

### 2.3. 今後の技術選定における考慮事項

- **Web3連携**  
  フェーズ2以降でNFTやトークンなどWeb3機能を導入する際には、Ethereum互換チェーン（Polygon、Arbitrumなど）、Solana、スマートコントラクト開発言語（Solidity、Rust）、および関連SDK（Web3.js、Ethers.jsなど）を選定する必要があります。

- **外部API連携**  
  eplus、Ticket Pia、X、LINEなどの外部API連携では、各API仕様に合ったSDKやHTTPクライアントライブラリを適切に選定します。
