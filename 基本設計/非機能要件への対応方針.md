# 非機能要件への対応方針設計書

## 1. 概要  
本設計書は、アーティストイベント管理SaaSサービス「Fanlogue」の非機能要件（「要件定義書.md」の「7.2 非機能要件」に記載）に対し、基本設計レベルでの対応方針を具体的に定義するものである。スケーラビリティ、パフォーマンス、セキュリティ、可用性、運用保守性、ユーザビリティ、信頼性といった側面から、システムが満たすべき品質特性と、その実現のためのアーキテクチャ上の考慮事項や技術的アプローチを明確にする。

## 2. 全体方針  
- クラウドネイティブの活用: AWSのマネージドサービスを最大限活用し、インフラの運用負荷を軽減しつつ、高いスケーラビリティ、可用性、セキュリティを実現する。  
- サーバーレスアーキテクチャの採用: AWS Lambda, API Gateway, Aurora Serverlessなどを中心に採用し、イベント駆動型で柔軟なスケーリングとコスト最適化を図る。  
- セキュリティファースト: 設計段階からセキュリティを考慮し、多層防御のアプローチでデータの保護と不正アクセス対策を徹底する。  
- オブザーバビリティの確保: ログ、メトリクス、トレースを収集・可視化することで、システムの健全性を継続的に監視し、問題発生時の迅速な特定と解決を可能にする。

## 3. 各非機能要件への対応方針

### 3.1. NFR7.2.1 スケーラビリティ  
要件: 急激なアクセス増加やデータ量の増大に対応できるスケーラビリティを有すること。  
対応方針:  
- コンピューティング:  
  - AWS Lambda: API Gatewayからのリクエストに応じて自動的にスケールアウトするため、急激なアクセス増加に柔軟に対応可能。アイドル時は課金が発生しないためコスト効率も良い。  
  - ECS Fargate (バッチ処理/ワーカー): 必要に応じて、長時間実行されるバッチ処理や非同期ワーカープロセスにFargateを採用し、コンテナレベルでのスケーリングを可能にする。  
- データベース:  
  - AWS Aurora Serverless v2 (PostgreSQL): ワークロードに応じて自動的に容量を調整するため、データベースのスケーリング運用負荷を大幅に軽減する。  
  - リードレプリカ: 読み込み負荷が高い場合は、Auroraのリードレプリカを導入し、読み込み処理を分散することでパフォーマンスを向上させる（フェーズ2以降検討）。  
- ストレージ:  
  - AWS S3: オブジェクトストレージとして容量無制限でスケーリングするため、画像などの静的コンテンツやユーザーアップロードファイルの保存に最適。  
- メッセージキュー:  
  - AWS SQS: 非同期処理のキューイングに利用し、バックエンドサービスの負荷変動を吸収し、システム全体の応答性を維持する。  
- ロードバランシング:  
  - AWS API Gateway: API Gatewayがリクエストのルーティングとロードバランシングを自動的に行うため、バックエンドサービスへの負荷を適切に分散する。

### 3.2. NFR7.2.2 パフォーマンス  
要件: ユーザー操作に対する応答時間が許容範囲内であること。  
対応方針:  
- API Gatewayの活用: API Gatewayによるキャッシュ機能（静的コンテンツや頻繁にアクセスされるデータ）を利用し、バックエンドへのリクエスト数を削減し応答速度を向上させる。  
- CDNの導入: AWS CloudFrontを導入し、静的コンテンツ（Webアプリケーションのフロントエンドファイル、アーティスト画像、イベント画像など）をユーザーに地理的に近いエッジロケーションから高速配信する。  
- データベースクエリの最適化: 適切なインデックス設計を行い、検索性能を最大化する。N+1問題の回避、JOINの最適化など、クエリチューニングを継続的に実施する。  
- 非同期処理: 時間のかかる処理（例: 報酬付与のバックグラウンド処理）は非同期化し、APIの応答時間を短縮する。  
- データキャッシュ: 頻繁にアクセスされるが更新頻度の低いデータに対しては、AWS ElastiCache (Redis) の導入を検討し、データベースへのアクセス負荷を軽減する（フェーズ2以降検討）。

### 3.3. NFR7.3.x セキュリティ  
要件: ユーザーデータ、イベント情報などの機密情報を保護し、不正アクセスやデータ漏洩を防ぐこと。  
対応方針:  
- 認証・認可:  
  - AWS Cognito: ユーザー認証とセッション管理に利用し、堅牢な認証基盤を提供する。多要素認証（MFA）の導入を推奨する。  
  - JWT (JSON Web Token): API認証に利用し、セッションレスでスケーラブルな認証を実現する。トークンの有効期限を適切に設定し、リフレッシュトークンによる更新メカニズムを実装する。  
  - ロールベースアクセス制御 (RBAC): ユーザー（一般ユーザー）、運営者、アーティストといったロールを定義し、各ロールに許可されたAPIエンドポイントやデータ操作を厳密に制御する。  
- データ保護:  
  - 通信の暗号化: 全ての通信（クライアント-API Gateway間、API Gateway-Lambda間、Lambda-DB間など）において、SSL/TLSによる暗号化を強制する。  
  - データベースの暗号化: Auroraの保存時暗号化（KMSによる管理）を有効にし、データベースに保存されるデータを保護する。  
  - パスワードのハッシュ化: ユーザーパスワードは、Cognitoに保存される際も強力なハッシュアルゴリズム（例: bcrypt）でハッシュ化され、平文で保存しない。  
- 脆弱性対策:  
  - OWASP Top 10への対応: Webアプリケーションの一般的な脆弱性（SQLインジェクション、XSS、CSRFなど）に対して、フレームワークの機能や適切なコーディング規約、WAF (Web Application Firewall) の導入（AWS WAF）により対策を行う。  
  - 入力バリデーション: 全てのユーザー入力に対し、サーバーサイドで厳格なバリデーションを実施する。  
  - 依存関係の管理: 使用するライブラリやフレームワークの脆弱性情報を常に監視し、定期的にアップデートを行う。  
- アクセス管理:  
  - AWS IAM: AWSリソースへのアクセスは、最小権限の原則に基づき、IAMロールとポリシーを厳密に設定する。  
  - VPC (Virtual Private Cloud): データベースやバックエンドLambda関数は、VPC内に配置し、インターネットからの直接アクセスを制限する。  
- ログと監査:  
  - AWS CloudTrail: AWSアカウント内のAPIアクティビティを記録し、監査証跡として利用する。  
  - AWS CloudWatch Logs: 各サービスのログを一元的に収集し、不審なアクティビティを監視する。  
- Web3関連機能導
